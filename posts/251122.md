---
title: "APIãƒ†ã‚¹ãƒˆã‚’è‡ªå‹•åŒ–ã™ã‚‹"
date: "2025-11-22"
excerpt: "Newman + Pytest + k6ã‚’ä¸€æ‹¬å®Ÿè¡Œã™ã‚‹"
---

APIé–‹ç™ºã§ã®ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–ã«ã¤ã„ã¦ã§ã™ã€‚

ãƒ„ãƒ¼ãƒ«é¸å®šã¯ã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ã§ã€ãã‚Œã‚‰ã®è¤‡æ•°ãƒ„ãƒ¼ãƒ«ã‚’ã©ã®ã‚ˆã†ã«å®Ÿè¡Œãƒ»é‹ç”¨ã™ã‚‹ã‹ã‚’æ¤œè¨Žã—ã¾ã—ãŸã€‚

---

## ä½¿ç”¨ãƒ„ãƒ¼ãƒ«

å‰æã¨ã—ã¦ã€æ­£å¸¸ç³»ãƒ»ç•°å¸¸ç³»ãƒ»æº–æ­£å¸¸ç³»ãƒ»å¢ƒç•Œå€¤ãƒ»é™ç•Œå€¤ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã—ã€æ©Ÿèƒ½è¦ä»¶ãŒæº€ãŸã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¾ã™ã€‚

ä½¿ç”¨ãƒ„ãƒ¼ãƒ«ã¯å¤§ããä»¥ä¸‹ã®ï¼“ã¤ã§ã™ã€‚ã“ã“ã§ã¯ç°¡å˜ã«æ¦‚è¦ã®ã¿ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

#### 1. **Newman**
https://github.com/postmanlabs/newman

Postmanã§ä½œæˆã—ãŸã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’CLIã‹ã‚‰å®Ÿè¡Œã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«`newman-reporter-html`ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¦ã€Newmanã®çµæžœã‚’HTMLå½¢å¼ã®ãƒ¬ãƒãƒ¼ãƒˆã§å‡ºåŠ›ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã¾ã™ã€‚

#### 2. **k6**
https://k6.io/
JavaScriptã«ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªã‚’è¨˜è¿°ã—ã¦è² è·ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

ã“ã¡ã‚‰ã‚‚CLIãƒ„ãƒ¼ãƒ«ã¨ã—ã¦å‹•ä½œã—ã¾ã™ã€‚

#### 3. **Python + requests**
https://github.com/psf/requests

Pythonã®requestsãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ã¦HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã€pytestã‚’ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ã—ã¦å®Ÿè¡Œã™ã‚‹æ§‹æˆã§ã™ã€‚

ä»®æƒ³ç’°å¢ƒï¼ˆvenvï¼‰ä¸Šã§å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’Pythonã§è¨˜è¿°ã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚

ã¾ãŸã€ä»¥ä¸‹ã‚‚ä½µã›ã¦åˆ©ç”¨ã—ã¾ã™ã€‚

`pytest-html`ï¼špytestã®çµæžœã‚’HTMLå½¢å¼ã®ãƒ¬ãƒãƒ¼ãƒˆã§å‡ºåŠ›ã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³
`faker`ï¼šãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆä¾‹ï¼šåå‰ã€ä½æ‰€ã€æ–‡ç« ãªã©ï¼‰ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª


## å®Ÿæ–½æ‰‹é †

ä¸Šè¨˜å…¨ã¦ã‚’ä¸€æ‹¬ã§å®Ÿè¡Œã§ãã‚‹ç’°å¢ƒã‚’æ•´ãˆã¾ã™ã€‚

ï¼ˆå‚è€ƒã«ã—ãŸã‚‚ã®ã¯ãªãå®Œå…¨ã«ã‚ªãƒªã‚¸ãƒŠãƒ«ãªã®ã§ã‚‚ã£ã¨ä¸€èˆ¬çš„ãªæ§‹æˆã‚„ä½œæ³•ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒ...ï¼‰

### **1. ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚„ç’°å¢ƒæƒ…å ±ã‚’å®šç¾©ã™ã‚‹**

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®æ§‹æˆã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚

``` bash
docs
â””â”€â”€ TESTING.md # å®Ÿæ–½è¦é …
tests
â”œâ”€â”€ k6
â”‚   â””â”€â”€ load_test.js # k6ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ newman
â”‚   â”œâ”€â”€ generate_env.sh
â”‚   â””â”€â”€ tests.postman_collection.json # postmanã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
â”œâ”€â”€ pytest
â”‚   â””â”€â”€ test_hoge_api.py # pytestã‚³ãƒ¼ãƒ‰
â”œâ”€â”€ results
â”œâ”€â”€ env.sh
â””â”€â”€ run_tests.sh
```

ã¾ãšãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ä½¿ç”¨ã™ã‚‹å€¤ã‚’`env.sh`ã«å®šç¾©ã—ã¾ã™ã€‚

```bash
# env.sh
#!/bin/bash

export BASE_URL='http://example.com'
export USER_ID='test_user'
export USER_TOKEN='hogehoge'
```

æ¬¡ã«ä¸Šè¨˜ã®å¤‰æ•°ã‚’ä½¿ç”¨ã—ã€`genarate_newman_env.sh`ã«ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®šç¾©ã—ã¾ã™ã€‚
ã“ã‚Œã‚’å®Ÿè¡Œã™ã‚‹ã¨`newman_env.json`ãŒç”Ÿæˆã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ãŠã‚Šã€newmanã®å®Ÿè¡Œæ™‚ã«ã¯ã“ã‚Œã‚’ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦æŒ‡å®šã—ã¾ã™ã€‚

```bash
# genarate_newman_env.sh
#!/bin/bash
set -e
source tests/env.sh

cat > tests/newman/newman_env.json <<EOF
{
  "id": "auto-generated-env",
  "name": "dev",
  "values": [
    { "key": "BASE_URL", "value": "$BASE_URL", "enabled": true },
    { "key": "USER_ID", "value": "$USER_ID", "enabled": true },
    { "key": "USER_TOKEN", "value": "$USER_TOKEN", "enabled": true }
  ]
}
EOF

echo "Postman environment.json generated at tests/newman/newman_env.json"
```

ãã—ã¦`k6`, `newman`, `pytest`ãƒ•ã‚©ãƒ«ãƒ€ã«ãã‚Œãžã‚Œã®ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’é…ç½®ã—ã¾ã™ã€‚

ï¼ˆã“ã“ã§ã¯è©³ç´°ã¯çœç•¥ã—ã¾ã™ï¼‰

æœ€å¾Œã«å„ãƒ†ã‚¹ãƒˆå®Ÿè¡Œç”¨ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’`tests/run_tests.sh`ã«ä½œæˆã—ã¾ã™ã€‚

```bash
# run_tests.sh
#!/bin/bash
set -e
source tests/env.sh

# çµæžœå‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
RESULT_DIR="tests/results"
# Postman collectionãƒ•ã‚¡ã‚¤ãƒ«å
POSTMAN_COLLECTION_FILE="postman_collection.json"

echo "Starting API Functional Tests..."

# 1. Newman Tests
echo "Running Newman tests..."
npx newman run tests/newman/$POSTMAN_COLLECTION_FILE \
  -e tests/newman/newman_env.json \
  --reporters cli,htmlextra,json \
  --reporter-htmlextra-export $RESULT_DIR/newman-report.html \
  --reporter-json-export $RESULT_DIR/newman-report.json || echo "Newman failed, continuing..."

# 2. Pytest Tests
echo "Running Pytest tests..."
source venv/bin/activate
pytest tests/pytest/test_hoge_api.py -v \
  --html=$RESULT_DIR/pytest-report.html \
  --self-contained-html \
  --junit-xml=$RESULT_DIR/pytest-junit.xml || echo "Pytest failed, continuing..."
  deactivate
 
# 3. k6 Load Tests
echo "Running k6 load tests..."
k6 run --out json=$RESULT_DIR/k6-results.json tests/k6/load_test.js
 
echo "All tests completed! Check $RESULT_DIR/ for reports."
```

å„ãƒ†ã‚¹ãƒˆã®æœ€å¾Œã«`|| echo "xxx..."`ã‚’æ›¸ã‹ãªã„ã¨ã€é€”ä¸­ã§ãƒ†ã‚¹ãƒˆãŒã“ã‘ãŸå ´åˆã«ãã“ã§çµ‚äº†ã—ã¦ã—ã¾ã†ã®ã§æ³¨æ„ã§ã™ã€‚

### **2. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**

ã“ã‚Œã§æº–å‚™ã¯å®Œäº†ã§ã™ã€‚

ä»¥ä¸‹ã®ã‚³ãƒžãƒ³ãƒ‰ã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
# newmanç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
bash tests/newman/generate_env.sh

# ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
bash tests/run_tests.sh
```

`tests/results`ã«ä»¥ä¸‹ã®é€šã‚Šãƒ†ã‚¹ãƒˆçµæžœãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚

- **Newman**ï¼š`newman-report.html`
- **pytest**ï¼š`pytest-report.html`
- **k6**ï¼š`k6-results.json`

ä¸€æ—¦ã¯CLIä¸Šã§å®Ÿè¡Œã—ã¦ã„ã¾ã™ãŒã€CI/CDã«çµ„ã¿è¾¼ã‚“ã§å®Œå…¨è‡ªå‹•åŒ–ã™ã‚‹äºˆå®šã§ã™ã€‚

ã¾ãŸã€å°†æ¥çš„ã«ã¯JUnit XMLè§£æžãƒ„ãƒ¼ãƒ«ãªã‚“ã‹ã‚’ä½¿ã£ã¦ç·åˆãƒ¬ãƒãƒ¼ãƒˆã‚‚å‡ºåŠ›ã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚

---

ç¾æ™‚ç‚¹ã§ä¸»è¦ãªãƒ†ã‚¹ãƒˆã¯newmanãŒæ‹…ã£ã¦ã„ã¾ã™ãŒã€å€‹äººçš„ã«ã¯é–‹ç™ºã‚‚ãƒ†ã‚¹ãƒˆã‚‚Postmanã‚ˆã‚ŠApidogã®æ–¹ãŒå¥½ã¿ãªã®ã§ã€Apidogã‚‚ã£ã¨æµ¸é€ã—ã¦ã»ã—ã„ã§ã™ðŸ¶
